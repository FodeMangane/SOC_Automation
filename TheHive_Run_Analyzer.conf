Cette action lance l'analyzer Cortex (VirusTotal) sur l'observable qui vient d'être ajouté au cas. L'analyse se fait depuis TheHive vers Cortex, et les résultats seront automatiquement visibles dans l'interface TheHive.
Récupération de l'ID de l'analyzer VirusTotal
Avant de configurer cette action, nous devons identifier l'analyzer VirusTotal dans Cortex.
Se connecter en SSH à la VM (10.0.30.104) et exécuter la commande suivante :
curl -H 'Authorization: Bearer MNfORsoKy2k+lJVfFFFS3pt+uC5ms7Gh' \
'http://10.0.30.104:9001/api/analyzer' | jq '.[] | select(.name == "VirusTotal_GetReport_3_1") | .id'

  Résultat attendu :
"0f12d003ba1b420c3353458c97d97b1c"
Cet identifiant unique sera utilisé dans la configuration de l'action.

Ajout de l'action HTTP
Glisser un nouvel élément HTTP sur le canvas.
Connecter TheHive_Add_Observable à ce nouveau HTTP.

  Configuration de TheHive_Run_Analyzer
Informations générales :
Name : TheHive_Run_Analyzer
Method : POST
http://10.0.30.104:9003/api/connector/cortex/job
Headers :
{
  "Authorization": "Bearer 8znRS1OuDC6W1POVa0fkCEeMxNZb9LZa",
  "Content-Type": "application/json"
}
Body :
{
  "cortexId": "cortex0",
  "analyzerId": "0f12d003ba1b420c3353458c97d97b1c",
  "artifactId": "$thehive_add_observable.body.#0._id",
  "parameters": {}
}
Points importants:
- L'URL utilise l'endpoint `/api/connector/cortex/job` spécifique aux analyzers (et non `/action` qui est pour les responders)
- `artifactId` utilise la syntaxe Shuffle `body.#0._id` pour accéder au premier élément du tableau (le `#0` représente l'index 0)
- `cortexId: "cortex0"` doit correspondre au nom du serveur Cortex configuré dans TheHive
- L'analyzer s'exécute et les résultats apparaissent automatiquement dans l'onglet Reports de l'observable dans TheHive
